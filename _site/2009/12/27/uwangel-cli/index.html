<!DOCTYPE html>
<html>
  <head>
    <title>UWAngel-CLI - Zero Wind :: Jamie Wong</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link href='http://fonts.googleapis.com/css?family=Questrial|Sansita+One' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" media="screen" href="/stylesheets/screen.css" type="text/css" />
    <link rel="stylesheet" media="screen" href="/stylesheets/pygments.css" type="text/css" />
  </head>

  <body class="bp" onload="prettyPrint()">
    <div class="page-container">
      <div class="page-sidebar-container">
        <div class="page-sidebar">

          <a href="/"><h1 class="site-title">
            Zer√∏ Wind
          </h1></a>

          <h2 class='my-name'>Jamie Wong</h2>

          <div class='short-bio'>
            <p>
              I'm a uWaterloo Software Engineering student from Ottawa.
              I'm currently an intern at Facebook.
            </p>
          </div>

          <div class="page-nav">
            <ul>
              <li><a href="/">blog</a></li>
              <li><a href="/resume/">resume</a></li>
              <li><a href="https://github.com/phleet">github</a></li>
              <li><a href="http://www.linkedin.com/profile/view?id=71283243">linkedin</a></li>
              <li><a href="http://stackoverflow.com/users/303911/jamie-wong">stack overflow</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="page-content-container">
        <div class="page-content">
          
            <h1 class='page-title'>UWAngel-CLI</h1>
          

          
<div class="post-date">
  Posted on December 27, 2009
</div>


<div class="post">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<div style="text-align:center">
  <img src="/images/uwangel-cli-1.png" width="480" height="244">
</div>


<p>Near the end of the semester, I was getting kind of tired of navigating UW-ACE
so frequently through my browsing and opening all the different tabs to grab all
the files I wanted. While all the pretty graphics make for a decent user
interface, it reduces the speed of the service.</p>

<p>But aside from that, I like being able to do as much as I possibly can from the
console.</p>

<p>So I made a Command Line Interface (CLI) for UW-ACE in php using cUrl. I built
in on my Macbook Pro in Snow Leopard, but it should work just fine on any *nix
machine, and possibly in Cygwin or other emulators.</p>

<p>As always, source is available on github: <a href="http://github.com/phleet/UWAngel-CLI">UWAngel-CLI @ Github</a>.</p>

<p>Since I always like to post snippets of code from my projects that may be
universally useful, I'll do that here too.</p>

<h2>CLI Colour in PHP</h2>

<p><code>cli_colours.php</code> included in the UWAngel-CLI source is just a collection of
constants which allow you to print out colours in your CLI scripts.</p>

<div class="highlight">
<pre><span class="cp">&lt;?</span>
<span class="nv">$COLOR_BLACK</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;30m"</span><span class="p">;</span>
<span class="nv">$COLOR_DARKGRAY</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;30m"</span><span class="p">;</span>
<span class="nv">$COLOR_BLUE</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;34m"</span><span class="p">;</span>
<span class="nv">$COLOR_LIGHTBLUE</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;34m"</span><span class="p">;</span>
<span class="nv">$COLOR_GREEN</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;32m"</span><span class="p">;</span>
<span class="nv">$COLOR_LIGHTGREEN</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;32m"</span><span class="p">;</span>
<span class="nv">$COLOR_CYAN</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;36m"</span><span class="p">;</span>
<span class="nv">$COLOR_LIGHTCYAN</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;36m"</span><span class="p">;</span>
<span class="nv">$COLOR_RED</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;31m"</span><span class="p">;</span>
<span class="nv">$COLOR_LIGHTRED</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;31m"</span><span class="p">;</span>
<span class="nv">$COLOR_PURPLE</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;35m"</span><span class="p">;</span>
<span class="nv">$COLOR_LIGHTPURPLE</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;35m"</span><span class="p">;</span>
<span class="nv">$COLOR_BROWN</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;33m"</span><span class="p">;</span>
<span class="nv">$COLOR_YELLOW</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;33m"</span><span class="p">;</span>
<span class="nv">$COLOR_LIGHTGRAY</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;37m"</span><span class="p">;</span>
<span class="nv">$COLOR_WHITE</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[1;37m"</span><span class="p">;</span>
<span class="nv">$COLOR_DEFAULT</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\033</span><span class="s2">[0;37m"</span><span class="p">;</span>

<span class="k">echo</span> <span class="o">&lt;&lt;&lt;</span> <span class="nx">EOT</span>
<span class="nx">One</span> <span class="nx">fish</span><span class="p">,</span>
<span class="nx">two</span> <span class="nx">fish</span><span class="p">,</span>
<span class="p">{</span><span class="nv">$COLOR_RED</span><span class="p">}</span><span class="nx">red</span><span class="p">{</span><span class="nv">$COLOR_DEFAULT</span><span class="p">}</span> <span class="nx">fish</span><span class="p">,</span>
<span class="p">{</span><span class="nv">$COLOR_BLUE</span><span class="p">}</span><span class="nx">blue</span><span class="p">{</span><span class="nv">$COLOR_DEFAULT</span><span class="p">}</span> <span class="nx">fish</span><span class="o">.</span>

<span class="nx">EOT</span><span class="p">;</span>
</pre>
</div>


<p>The only gripe I have about this is that <code>COLOR_DEFAULT</code> it's the same colour as
I have on by default in iTerm. Anyone know the escape code to make it actually
revert to what it was before instead of just making an assumption about what
color is being used?</p>

<h2>Hide Commandline Input</h2>

<p>One of the first things I looked up when I started this project today was how to
hide user input from the command line. I sure as hell didn't want people typing
their passwords for UWACE on screen and having it actually display.</p>

<p>It turns out you can do this by temporarily telling your TTY to stop echoing
what you type. The command for this is <code>stty -echo</code> and can be re-enabled using
<code>stty echo</code>. Below is how I implemented as part of the AngelAccess class to meet
my needs.</p>

<div class="highlight">
<pre><span class="cp">&lt;?</span>
<span class="k">function</span> <span class="nf">Prompt</span><span class="p">(</span><span class="nv">$prompt_text</span><span class="p">,</span><span class="nv">$hide</span> <span class="o">=</span> <span class="k">false</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$prompt_text</span><span class="p">;</span>
    <span class="nv">$input</span> <span class="o">=</span> <span class="s2">""</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$hide</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="sb">`stty -echo;head -n1;stty echo`</span><span class="p">);</span>
        <span class="k">echo</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nv">$input</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nb">fgets</span><span class="p">(</span><span class="nx">STDIN</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nv">$input</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre>
</div>


<p>As a complete side note, thanks to a boot-camped installation of Windows 7 (or
at least I'm fairly sure that's the culprit,) my Macbook Pro is now stuck on
Digital Out. This means I can't use the internal speakers on my computer under
Mac OS X. Well... what I should say is that I can't use them without some
annoying tricks. If I plug in my headphones, then tell my mac to use the input
jack for audio input, then my internal speakers appear under the output options
and let me use them. The speakers then work perfectly fine. They also work fine
under Windows 7. A direct side effect of digital out being stuck on is a read
light emanating from the audio jack.</p>

<p>The problem is apparently fairly common, unfortunately the only confirmed fixes
for it are sending it back to Apple or <a href="http://forums.macrumors.com/showthread.php?t=239287">wiggling a toothpick
around</a> in the audio jack. I had absolutely no luck with the toothpick, or
precision screwdriver, or pen cartridge, or paintbrush handle. If anyone knows
how to fix this problem, I would love to know. Otherwise, I'm just going to take
it into the Apple store in Rideau some time this week and hope they can fix the
problem. I really don't want to have to send my Mac in during my first week at
Velocity.</p>
</body></html>

</div>

<div class="related post-list">
  <h2>Related Posts</h2>
  <ul class="post-list-ul">
    
      <li>
        <a href="/2011/11/03/meet-doctor-jekyll/">Meet Doctor Jekyll</a>
        <span class='date'>03 November 2011</span>
      </li>
    
      <li>
        <a href="/2011/06/25/complex-asynchronous-queries-in-javascript/">Complex Asynchronous Queries in JavaScript</a>
        <span class='date'>25 June 2011</span>
      </li>
    
      <li>
        <a href="/2011/01/12/hacker-cup-qualification-round-solutions/">Hacker Cup Qualification Round - Solutions</a>
        <span class='date'>12 January 2011</span>
      </li>
    
      <li>
        <a href="/2010/11/17/mechanize-and-uwace-downloader/">Mechanize and UWAce Downloader</a>
        <span class='date'>17 November 2010</span>
      </li>
    
      <li>
        <a href="/2010/10/16/dfas-and-graphviz-dot/">DFAs and Graphviz DOT</a>
        <span class='date'>16 October 2010</span>
      </li>
    
  </ul>
</div>


</div>

        </div>
      </div>
    </div>

    
    <!-- google analytics async -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-11869199-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
        ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
  </body>
</html>
