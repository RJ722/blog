<!DOCTYPE html>
<html>
  <head>
    <title>Javascript Dependency Loading – jquery.atreq - Zero Wind :: Jamie Wong</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" media="screen" href="/stylesheets/screen.css" type="text/css" />
    
    
  </head>

  <body class="bp">
    <div class="page-container">
      <div class="page-sidebar">

        <div class="zero-wind">
          <a href="/"><h1 class="site-title">
            Zero Wind
          </h1></a>
        </div>

        <h2 class='my-name'>Jamie Wong</h2>

        <div class="page-nav">
          <ul>
            <li><a href="/">blog</a></li>
            <li><a href="/resume">resume</a></li>
            <li><a href="https://github.com/phleet">github</a></li>
            <li><a href="http://stackoverflow.com/users/303911/jamie-wong">stack overflow</a></li>
          </ul>
        </div>
      </div>

      <div class="page-content">
        <h1>Javascript Dependency Loading – jquery.atreq</h1>
        <div class="postdate">Posted on 14 Aug 2010</div>

<div class="post">
<p>For a project I'm working on, I have a fairly complex dependency tree and was getting fed up with manually including every single one in my haml layout file. So I started looking up other solutions and eventually decided none met my needs, so, as usual, I wrote my own.</p>

<p><a href="http://github.com/phleet/jquery.atreq">jquery.atreq @ github</a></p>

<p>Because there's not much to say beyond what I have in the readme, and because this blog is conveniently set up to format with markdown, I'm just going to display the current state of that here.</p>

<h1>jquery.atreq</h1>

<p>jquery.atreq loads your javascript dependencies asynchronously.</p>

<h2>How to use</h2>

<p>First, include your main application file with <code>$.atreq</code></p>

<pre><code>&lt;script type='text/javascript' src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"&gt;&lt;/script&gt;
&lt;script type='text/javascript' src="jquery.atreq.js"&gt;&lt;/script&gt;
&lt;script type='text/javascript'&gt;
$.atreq('application.js');
&lt;/script&gt;
</code></pre>

<p>Then inside your application.js and any other required files, place a require statement in the comments.</p>

<pre><code>// application.js
// @require 'lib/lib1.js'
// @require 'lib/lib2.js'

Library1Function();
Library2Function();
</code></pre>

<p><strong>NOTE</strong>: While <code>//@require</code> "blocks", <code>$.atreq</code> does not. This means the following will not work:</p>

<pre><code>$.atreq('lib/lib1.js');
Library1Function();
</code></pre>

<h2>Relative Require Paths</h2>

<p>Unless the require paths begin with a <code>/</code>, they're assumed to be relative to the location of the file they're in.</p>

<p>This means, since <code>lib1.js</code> is in <code>lib/</code>, the require statement below will load <code>lib/deb/lib1dep.js</code>. This makes your code portable across locations.</p>

<p>Each of the library files can also have their own dependencies, and <code>$.atreq</code> will make sure they're run in the correct order.</p>

<pre><code>// lib/lib1.js
// @require `dep/libdep.js`

function Library1Function() {
    alert('Awesome!");
}
</code></pre>

<h2>Redundant or Duplicate Requires</h2>

<p>Duplicate requires of the same file will neither request nor run the same file twice.
This is true even if the relative path is different from files. This means that:</p>

<pre><code>// lib/lib2.js
// @require '../shared/shared.js'
</code></pre>

<p>and</p>

<pre><code>// lib/lib3.js
// @require '../shared/shared.js'
</code></pre>

<p>will only make one request out to <code>shared/shared.js</code>.</p>

<h2>Alternatives and How They're Different</h2>

<h3>$.include</h3>

<p>A jQuery plugin by Tobiasz Cudnik, this does load external files asynchronously, but these dependencies are non-blocking. He dodges this issue by delaying the document.ready event</p>

<p>It even has the ability to load dependencies for included scripts like so (taken from his blog post):</p>

<pre><code>$.include(
    // URL
    'js/my-script.js',
    // will be loaded after this script
    $.include(baseURL+'js/my-other-script.js')
);
$.include('js/src/behaviors.js',
    // dependencies can also be an array
    [
        $.include('js/src/jquery-metadata.js'),
        $.include('js/src/jquery.form.js')
    ]
);
</code></pre>

<p>This is great, except that it requires all the dependencies to be loaded from the same file.
This means you won't get useful behaviour if one of the files you're including has internal dependencies.</p>

<p>See: <a href="http://tobiasz123.wordpress.com/2007/08/01/include-script-inclusion-jquery-plugin/">$.include() @ tobiasz123.wordpress.com</a></p>

<h3>$.require</h3>

<p>Another jQuery plugin, <code>$.require</code> doesn't have the problem of <code>$.include</code>: required files can require files of their own and scripts will still be parsed in the correct order.</p>

<p>The way it does this is it forces the scripts to be included synchronously. Functionality wise, this has no effect. However, it will result in slower load times for complex dependency trees.</p>

<p>The require paths in this script are relative to the inclusion point (the HTML file), not the script itself.</p>

<p>Comparison of load times for the following dependency tree:</p>

<pre><code>application.js
|--- 1.js
|    |--- 1a.js
|    |--- 1b.js
|    \--- shared.js
\--- 2.js
     |--- 2a.js
     |--- 2b.js
     \--- shared.js
</code></pre>

<p>Inside each file is the required include statements, a loop iterating 10000 times, and ~4kb of lorem ipsum in comments to bloat the file size.</p>

<p>$.atreq:</p>

<p><img src="http://phleet.github.com/images/atreq/atreqfirebug.png" alt="$.atreq firebug" /></p>

<p>$.require:</p>

<p><img src="http://phleet.github.com/images/atreq/dotreqfirebug.png" alt="$.require firebug" /></p>

<p>Note the difference in the load order - there's no reason why 1.js and 2.js shouldn't load at the same time.</p>

<p>See: <a href="http://plugins.jquery.com/project/require">$.require @ plugins.jquery.com</a></p>

<p><strong>WARNING</strong>: At time of writing, the script provided on that page does not work and makes some strange assumptions about the location of your javascript files on the server. Use with caution.</p>

</div>
 
<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>25 Jun 2011</span> - <a href="/2011/06/25/complex-asynchronous-queries-in-javascript/">Complex Asynchronous Queries in JavaScript</a></li>
    
      <li><span>12 Jan 2011</span> - <a href="/2011/01/12/hacker-cup-qualification-round-solutions/">Hacker Cup Qualification Round - Solutions</a></li>
    
      <li><span>17 Nov 2010</span> - <a href="/2010/11/17/mechanize-and-uwace-downloader/">Mechanize and UWAce Downloader</a></li>
    
      <li><span>16 Oct 2010</span> - <a href="/2010/10/16/dfas-and-graphviz-dot/">DFAs and Graphviz DOT</a></li>
    
      <li><span>30 Sep 2010</span> - <a href="/2010/09/30/make-your-life-easier-with-gnu-make/">Make your life easier with GNU Make.</a></li>
    
  </ul>
</div>


</div>
      </div>

      <div class="clear">
    </div>
  </body>
</html>
