<!DOCTYPE html>
<html>
  <head>
    <title>Javascript Dependency Loading – jquery.atreq - Zero Wind :: Jamie Wong</title>
    <meta property="og:image" content="http://jamie-wong.com/images/logo.png" />
    <meta property="og:site_name" content="Zero Wind :: Jamie Wong" />

    <link rel="icon" href="/favicon.ico" />

    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link href='http://fonts.googleapis.com/css?family=Questrial|Sansita+One' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" media="screen" href="/stylesheets/screen.css" type="text/css" />
    <link rel="stylesheet" media="screen" href="/stylesheets/pygments.css" type="text/css" />
  </head>

  <body class="bp">
    <div class="page-container">
      <div class="page-sidebar-container">
        <div class="page-sidebar">

          <a href="/"><h1 class="site-title">
            Zerø Wind
          </h1></a>

          <h2 class='my-name'>Jamie Wong</h2>

          <div class='short-bio'>
            <p>
              I'm a uWaterloo Software Engineering student from Ottawa.
              I'm currently an intern at Facebook.
            </p>
          </div>

          <div class="page-nav">
            <ul>
              <li><a href="/">blog</a></li>
              <li><a href="/resume/">resume</a></li>
              <li><a href="https://github.com/phleet">github</a></li>
              <li><a href="http://twitter.com/jlfwong">twitter</a></li>
              <li><a href="http://www.linkedin.com/profile/view?id=71283243">linkedin</a></li>
              <li><a href="http://stackoverflow.com/users/303911/jamie-wong">stack overflow</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="page-content-container">
        <div class="page-content">
          
            <h1 class='page-title'>Javascript Dependency Loading – jquery.atreq</h1>
          

          
<div class="post-date">
  Posted on August 14, 2010
</div>


<div class="post">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p>For a project I'm working on, I have a fairly complex dependency tree and was getting fed up with manually including every single one in my haml layout file. So I started looking up other solutions and eventually decided none met my needs, so, as usual, I wrote my own.</p>

<p><a href="http://github.com/phleet/jquery.atreq">jquery.atreq @ github</a></p>

<p>Because there's not much to say beyond what I have in the readme, and because this blog is conveniently set up to format with markdown, I'm just going to display the current state of that here.</p>

<h1>jquery.atreq</h1>

<p>jquery.atreq loads your javascript dependencies asynchronously.</p>

<h2>How to use</h2>

<p>First, include your main application file with <code>$.atreq</code></p>

<div class="highlight">
<pre><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">'text/javascript'</span> <span class="na">src=</span><span class="s">"http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">'text/javascript'</span> <span class="na">src=</span><span class="s">"jquery.atreq.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">'text/javascript'</span><span class="nt">&gt;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">atreq</span><span class="p">(</span><span class="s1">'application.js'</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</pre>
</div>


<p>Then inside your application.js and any other required files, place a require statement in the comments.</p>

<div class="highlight">
<pre><span class="c1">// application.js</span>
<span class="c1">// @require 'lib/lib1.js'</span>
<span class="c1">// @require 'lib/lib2.js'</span>

<span class="nx">Library1Function</span><span class="p">();</span>
<span class="nx">Library2Function</span><span class="p">();</span>
</pre>
</div>


<p><strong>NOTE</strong>: While <code>//@require</code> "blocks", <code>$.atreq</code> does not. This means the following will not work:</p>

<div class="highlight">
<pre><span class="nx">$</span><span class="p">.</span><span class="nx">atreq</span><span class="p">(</span><span class="s1">'lib/lib1.js'</span><span class="p">);</span>
<span class="nx">Library1Function</span><span class="p">();</span>
</pre>
</div>


<h2>Relative Require Paths</h2>

<p>Unless the require paths begin with a <code>/</code>, they're assumed to be relative to the location of the file they're in.</p>

<p>This means, since <code>lib1.js</code> is in <code>lib/</code>, the require statement below will load <code>lib/deb/lib1dep.js</code>. This makes your code portable across locations.</p>

<p>Each of the library files can also have their own dependencies, and <code>$.atreq</code> will make sure they're run in the correct order.</p>

<div class="highlight">
<pre><span class="c1">// lib/lib1.js</span>
<span class="c1">// @require `dep/libdep.js`</span>

<span class="kd">function</span> <span class="nx">Library1Function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="err">'</span><span class="nx">Awesome</span><span class="o">!</span><span class="err">"</span><span class="p">);</span>
<span class="p">}</span>
</pre>
</div>


<h2>Redundant or Duplicate Requires</h2>

<p>Duplicate requires of the same file will neither request nor run the same file twice.
This is true even if the relative path is different from files. This means that:</p>

<div class="highlight">
<pre><span class="c1">// lib/lib2.js</span>
<span class="c1">// @require '../shared/shared.js'</span>
</pre>
</div>


<p>and</p>

<div class="highlight">
<pre><span class="c1">// lib/lib3.js</span>
<span class="c1">// @require '../shared/shared.js'</span>
</pre>
</div>


<p>will only make one request out to <code>shared/shared.js</code>.</p>

<h2>Alternatives and How They're Different</h2>

<h3>$.include</h3>

<p>A jQuery plugin by Tobiasz Cudnik, this does load external files asynchronously, but these dependencies are non-blocking. He dodges this issue by delaying the document.ready event</p>

<p>It even has the ability to load dependencies for included scripts like so (taken from his blog post):</p>

<div class="highlight">
<pre><span class="nx">$</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span>
    <span class="c1">// URL</span>
    <span class="s1">'js/my-script.js'</span><span class="p">,</span>
    <span class="c1">// will be loaded after this script</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="nx">baseURL</span><span class="o">+</span><span class="s1">'js/my-other-script.js'</span><span class="p">)</span>
<span class="p">);</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">'js/src/behaviors.js'</span><span class="p">,</span>
    <span class="c1">// dependencies can also be an array</span>
    <span class="p">[</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">'js/src/jquery-metadata.js'</span><span class="p">),</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">include</span><span class="p">(</span><span class="s1">'js/src/jquery.form.js'</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">);</span>
</pre>
</div>


<p>This is great, except that it requires all the dependencies to be loaded from the same file.
This means you won't get useful behaviour if one of the files you're including has internal dependencies.</p>

<p>See: <a href="http://tobiasz123.wordpress.com/2007/08/01/include-script-inclusion-jquery-plugin/">$.include() @ tobiasz123.wordpress.com</a></p>

<h3>$.require</h3>

<p>Another jQuery plugin, <code>$.require</code> doesn't have the problem of <code>$.include</code>: required files can require files of their own and scripts will still be parsed in the correct order.</p>

<p>The way it does this is it forces the scripts to be included synchronously. Functionality wise, this has no effect. However, it will result in slower load times for complex dependency trees.</p>

<p>The require paths in this script are relative to the inclusion point (the HTML file), not the script itself.</p>

<p>Comparison of load times for the following dependency tree:</p>

<pre><code>application.js
|--- 1.js
|    |--- 1a.js
|    |--- 1b.js
|    \--- shared.js
\--- 2.js
     |--- 2a.js
     |--- 2b.js
     \--- shared.js
</code></pre>

<p>Inside each file is the required include statements, a loop iterating 10000 times, and ~4kb of lorem ipsum in comments to bloat the file size.</p>

<p>$.atreq:</p>

<p><img src="/images/atreqfirebug.png" alt="$.atreq firebug"></p>

<p>$.require:</p>

<p><img src="/images/dotreqfirebug.png" alt="$.require firebug"></p>

<p>Note the difference in the load order - there's no reason why 1.js and 2.js shouldn't load at the same time.</p>

<p>See: <a href="http://plugins.jquery.com/project/require">$.require @ plugins.jquery.com</a></p>

<p><strong>WARNING</strong>: At time of writing, the script provided on that page does not work and makes some strange assumptions about the location of your javascript files on the server. Use with caution.</p>
</body></html>

</div>

<div class="related post-list">
  <h2>Related Posts</h2>
  <ul class="post-list-ul">
    
      <li>
        <a href="/2011/10/03/meet-doctor-jekyll/">Meet Doctor Jekyll</a>
        <span class='date'>03 October 2011</span>
      </li>
    
      <li>
        <a href="/2011/06/25/complex-asynchronous-queries-in-javascript/">Complex Asynchronous Queries in JavaScript</a>
        <span class='date'>25 June 2011</span>
      </li>
    
      <li>
        <a href="/2011/01/12/hacker-cup-qualification-round-solutions/">Hacker Cup Qualification Round - Solutions</a>
        <span class='date'>12 January 2011</span>
      </li>
    
      <li>
        <a href="/2010/11/17/mechanize-and-uwace-downloader/">Mechanize and UWAce Downloader</a>
        <span class='date'>17 November 2010</span>
      </li>
    
      <li>
        <a href="/2010/10/16/dfas-and-graphviz-dot/">DFAs and Graphviz DOT</a>
        <span class='date'>16 October 2010</span>
      </li>
    
  </ul>
</div>


</div>

        </div>
      </div>
    </div>

    
    <!-- google analytics async -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-11869199-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
        ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
  </body>
</html>
