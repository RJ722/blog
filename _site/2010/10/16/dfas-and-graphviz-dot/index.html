<!DOCTYPE html>
<html>
  <head>
    <title>DFAs and Graphviz DOT - Zero Wind :: Jamie Wong</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link href='http://fonts.googleapis.com/css?family=Questrial|Sansita+One' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" media="screen" href="/stylesheets/screen.css" type="text/css" />
    <link rel="stylesheet" media="screen" href="/stylesheets/pygments.css" type="text/css" />
  </head>

  <body class="bp" onload="prettyPrint()">
    <div class="page-container">
      <div class="page-sidebar-container">
        <div class="page-sidebar">

          <a href="/"><h1 class="site-title">
            Zer√∏ Wind
          </h1></a>

          <h2 class='my-name'>Jamie Wong</h2>

          <div class='short-bio'>
            <p>
              I'm a uWaterloo Software Engineering student from Ottawa.
              I'm currently an intern at Facebook.
            </p>
          </div>

          <div class="page-nav">
            <ul>
              <li><a href="/">blog</a></li>
              <li><a href="/resume/">resume</a></li>
              <li><a href="https://github.com/phleet">github</a></li>
              <li><a href="http://twitter.com/jlfwong">twitter</a></li>
              <li><a href="http://www.linkedin.com/profile/view?id=71283243">linkedin</a></li>
              <li><a href="http://stackoverflow.com/users/303911/jamie-wong">stack overflow</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="page-content-container">
        <div class="page-content">
          
            <h1 class='page-title'>DFAs and Graphviz DOT</h1>
          

          
<div class="post-date">
  Posted on October 16, 2010
</div>


<div class="post">
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<p>As is usually the case with CS assignments, I tend to focus on reducing debugging time as much as possible by spending time coding things to make my life (and hopefully yours) easier.</p>

<p>On the latest assignment we are required to describe DFAs (Deterministic Finite Automatas) in a <a href="http://www.student.cs.uwaterloo.ca/~cs241/dfa/DFAfileformat.html">format</a> with very low human readability, I knew immediately that I was going to write something to allow me to write my DFAs in a more human readable format so that I could sanely debug them. So instead of this:</p>

<pre><code>2
0
1
5
start
zero
0mod3
1mod3
2mod3
start
2
zero
0mod3
8
start 0 zero
start 1 1mod3
1mod3 0 2mod3
1mod3 1 0mod3
2mod3 0 1mod3
2mod3 1 2mod3
0mod3 0 0mod3
0mod3 1 1mod3
</code></pre>

<p>I can do this in Ruby:</p>

<div class="highlight">
<pre><span class="n">dfa</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:alphabet</span> <span class="o">=&gt;</span> <span class="sx">%w(</span>
<span class="sx">    0</span>
<span class="sx">    1</span>
<span class="sx">  )</span><span class="p">,</span>
  <span class="ss">:states</span> <span class="o">=&gt;</span> <span class="sx">%w(</span>
<span class="sx">    start</span>
<span class="sx">    zero</span>
<span class="sx">    0mod3</span>
<span class="sx">    1mod3</span>
<span class="sx">    2mod3</span>
<span class="sx">  )</span><span class="p">,</span>
  <span class="ss">:initial</span> <span class="o">=&gt;</span> <span class="s1">'start'</span><span class="p">,</span>
  <span class="ss">:final</span> <span class="o">=&gt;</span> <span class="sx">%w(</span>
<span class="sx">    zero</span>
<span class="sx">    0mod3</span>
<span class="sx">  )</span><span class="p">,</span>
  <span class="ss">:transitions</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="s1">'start'</span> <span class="o">=&gt;</span> <span class="o">[</span>
      <span class="o">[</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'zero'</span><span class="o">]</span><span class="p">,</span>
      <span class="o">[</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'1mod3'</span><span class="o">]</span>
    <span class="o">]</span><span class="p">,</span>
    <span class="s1">'1mod3'</span> <span class="o">=&gt;</span> <span class="o">[</span>
      <span class="o">[</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'2mod3'</span><span class="o">]</span><span class="p">,</span>
      <span class="o">[</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'0mod3'</span><span class="o">]</span>
    <span class="o">]</span><span class="p">,</span>
    <span class="s1">'2mod3'</span> <span class="o">=&gt;</span> <span class="o">[</span>
      <span class="o">[</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'1mod3'</span><span class="o">]</span><span class="p">,</span>
      <span class="o">[</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'2mod3'</span><span class="o">]</span>
    <span class="o">]</span><span class="p">,</span>
    <span class="s1">'0mod3'</span> <span class="o">=&gt;</span> <span class="o">[</span>
      <span class="o">[</span><span class="s1">'0'</span><span class="p">,</span><span class="s1">'0mod3'</span><span class="o">]</span><span class="p">,</span>
      <span class="o">[</span><span class="s1">'1'</span><span class="p">,</span><span class="s1">'1mod3'</span><span class="o">]</span>
    <span class="o">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre>
</div>


<p>For those of you not familiar with ruby, <code>%w(one two three)</code> is equivalent to <code>['one','two','three']</code>. Just a bit of syntactic sugar.</p>

<p>You can generate the DFA format required by Marmoset with the following function:</p>

<div class="highlight">
<pre><span class="k">def</span> <span class="nf">dfa_output</span><span class="p">(</span><span class="n">dfa</span><span class="p">)</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">dfa</span><span class="o">[</span><span class="ss">:alphabet</span><span class="o">].</span><span class="n">length</span><span class="o">.</span><span class="n">to_s</span>
  <span class="n">dfa</span><span class="o">[</span><span class="ss">:alphabet</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">c</span><span class="o">|</span> <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="o">.</span><span class="n">to_s</span><span class="p">}</span>

  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">dfa</span><span class="o">[</span><span class="ss">:states</span><span class="o">].</span><span class="n">length</span><span class="o">.</span><span class="n">to_s</span>
  <span class="n">dfa</span><span class="o">[</span><span class="ss">:states</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="o">.</span><span class="n">to_s</span><span class="p">}</span>

  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">dfa</span><span class="o">[</span><span class="ss">:initial</span><span class="o">].</span><span class="n">to_s</span>

  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">dfa</span><span class="o">[</span><span class="ss">:final</span><span class="o">].</span><span class="n">length</span><span class="o">.</span><span class="n">to_s</span>
  <span class="n">dfa</span><span class="o">[</span><span class="ss">:final</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">f</span><span class="o">.</span><span class="n">to_s</span><span class="p">}</span>

  <span class="n">transitions</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">dfa</span><span class="o">[</span><span class="ss">:transitions</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">start</span><span class="p">,</span><span class="n">pair_array</span><span class="o">|</span>
    <span class="n">pair_array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span><span class="n">targ</span><span class="p">)</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">sym</span><span class="o">.</span><span class="n">is_a?</span> <span class="nb">String</span>
        <span class="n">transitions</span> <span class="o">&lt;&lt;</span> <span class="s2">"</span><span class="si">#{</span><span class="n">start</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">sym</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">targ</span><span class="si">}</span><span class="s2">"</span>
      <span class="k">else</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
          <span class="n">transitions</span> <span class="o">&lt;&lt;</span> <span class="s2">"</span><span class="si">#{</span><span class="n">start</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">s</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">targ</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="n">transitions</span><span class="o">.</span><span class="n">length</span><span class="o">.</span><span class="n">to_s</span>
  <span class="n">lines</span> <span class="o">+=</span> <span class="n">transitions</span>

  <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>
</pre>
</div>


<p>And then invoking with</p>

<div class="highlight">
<pre><span class="nb">puts</span> <span class="n">dfa_output</span><span class="p">(</span><span class="n">dfa</span><span class="p">)</span>
</pre>
</div>


<p>I designed the function with ranges and multiple transition tokens in mind, so you can do stuff like this:</p>

<div class="highlight">
<pre><span class="s1">'start_state'</span> <span class="o">=&gt;</span> <span class="o">[</span>
  <span class="o">[</span><span class="sx">%w(one that other)</span><span class="p">,</span><span class="s1">'end_state'</span><span class="o">]</span><span class="p">,</span>
  <span class="o">[</span><span class="mi">1</span><span class="o">.</span><span class="n">.</span><span class="mi">9</span><span class="p">,</span><span class="s1">'X'</span><span class="o">]</span>
<span class="o">]</span>
</pre>
</div>


<p>Now, this makes fixing problems, once discovered, much much simpler than trying to locate the error in the DFA format, but it still doesn't help much by way of identifying problems in the DFA itself. Probably the easiest way to look at a DFA is as a picture. Thankfully, there exists a set of tools perfect for this task known as <a href="http://www.graphviz.org/">Graphviz</a>.</p>

<h1>Graphviz DOT</h1>

<p><img src="http://imgur.com/FBFpb.png" alt="Sample Graph"></p>

<p>Graphviz is a collection of utilities used for visualizing graphs. The tool of interest for this post is DOT.
It produces the kind of thing you can see above - which is the same graph described by the ruby code and the DFA format above.</p>

<p>The syntax of DOT is very simple, and is better explained by <a href="http://en.wikipedia.org/wiki/DOT_language">the DOT language wiki entry</a> than by the official documentation.
The DOT description of the above graph is as follows:</p>

<pre><code>digraph dfa {
  "" [shape=none]
  "start" [shape=circle]
  "zero" [shape=doublecircle]
  "0mod3" [shape=doublecircle]
  "1mod3" [shape=circle]
  "2mod3" [shape=circle]

  "" -&gt; "start"
  "1mod3" -&gt; "2mod3" [label="0"]
  "1mod3" -&gt; "0mod3" [label="1"]
  "0mod3" -&gt; "0mod3" [label="0"]
  "0mod3" -&gt; "1mod3" [label="1"]
  "2mod3" -&gt; "1mod3" [label="0"]
  "2mod3" -&gt; "2mod3" [label="1"]
  "start" -&gt; "zero" [label="0"]
  "start" -&gt; "1mod3" [label="1"]
}
</code></pre>

<p>And this is the ruby code to generate that output using the <code>dfa = { ... }</code> format at the beginning of the post.</p>

<div class="highlight">
<pre><span class="k">def</span> <span class="nf">dot_output</span><span class="p">(</span><span class="n">dfa</span><span class="p">)</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="o">[]</span>
  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="s2">"digraph dfa {"</span>

  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="sx">%(</span><span class="se">\t</span><span class="sx">"" [shape=none])</span>

  <span class="n">dfa</span><span class="o">[</span><span class="ss">:states</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">state</span><span class="o">|</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">dfa</span><span class="o">[</span><span class="ss">:final</span><span class="o">].</span><span class="n">include?</span> <span class="n">state</span><span class="p">)</span>
      <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="sx">%(</span><span class="se">\t</span><span class="sx">"</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="sx">" [shape=doublecircle])</span>
    <span class="k">else</span>
      <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="sx">%(</span><span class="se">\t</span><span class="sx">"</span><span class="si">#{</span><span class="n">state</span><span class="si">}</span><span class="sx">" [shape=circle])</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="s1">''</span>
  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="sx">%(</span><span class="se">\t</span><span class="sx">"" -&gt; "</span><span class="si">#{</span><span class="n">dfa</span><span class="o">[</span><span class="ss">:initial</span><span class="o">]</span><span class="si">}</span><span class="sx">")</span>

  <span class="n">dfa</span><span class="o">[</span><span class="ss">:transitions</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">start</span><span class="p">,</span><span class="n">pair_array</span><span class="o">|</span>
    <span class="n">pair_array</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span><span class="n">targ</span><span class="p">)</span><span class="o">|</span>
      <span class="k">if</span> <span class="n">sym</span><span class="o">.</span><span class="n">is_a?</span> <span class="nb">String</span>
        <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="sx">%(</span><span class="se">\t</span><span class="sx">"</span><span class="si">#{</span><span class="n">start</span><span class="si">}</span><span class="sx">" -&gt; "</span><span class="si">#{</span><span class="n">targ</span><span class="si">}</span><span class="sx">" [label="</span><span class="si">#{</span><span class="n">sym</span><span class="si">}</span><span class="sx">"])</span>
      <span class="k">else</span>
        <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="sx">%(</span><span class="se">\t</span><span class="sx">"</span><span class="si">#{</span><span class="n">start</span><span class="si">}</span><span class="sx">" -&gt; "</span><span class="si">#{</span><span class="n">targ</span><span class="si">}</span><span class="sx">" [label="[</span><span class="si">#{</span><span class="n">sym</span><span class="o">.</span><span class="n">collect</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:to_s</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span><span class="si">}</span><span class="sx">]"])</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">lines</span> <span class="o">&lt;&lt;</span> <span class="s2">"}"</span>

  <span class="k">return</span> <span class="n">lines</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>
</pre>
</div>


<p>Once you've installed Graphviz, you can generate a PNG of the graph by running</p>

<div class="highlight">
<pre>dot -Tpng &lt; graph.dot &gt; graph.png
</pre>
</div>


<p>Enjoy CS241 A5.</p>
</body></html>

</div>

<div class="related post-list">
  <h2>Related Posts</h2>
  <ul class="post-list-ul">
    
      <li>
        <a href="/2011/10/03/meet-doctor-jekyll/">Meet Doctor Jekyll</a>
        <span class='date'>03 October 2011</span>
      </li>
    
      <li>
        <a href="/2011/06/25/complex-asynchronous-queries-in-javascript/">Complex Asynchronous Queries in JavaScript</a>
        <span class='date'>25 June 2011</span>
      </li>
    
      <li>
        <a href="/2011/01/12/hacker-cup-qualification-round-solutions/">Hacker Cup Qualification Round - Solutions</a>
        <span class='date'>12 January 2011</span>
      </li>
    
      <li>
        <a href="/2010/11/17/mechanize-and-uwace-downloader/">Mechanize and UWAce Downloader</a>
        <span class='date'>17 November 2010</span>
      </li>
    
      <li>
        <a href="/2010/09/30/make-your-life-easier-with-gnu-make/">Make your life easier with GNU Make.</a>
        <span class='date'>30 September 2010</span>
      </li>
    
  </ul>
</div>


</div>

        </div>
      </div>
    </div>

    
    <!-- google analytics async -->
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "UA-11869199-1"]);
      _gaq.push(["_trackPageview"]);
      (function() {
        var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
        ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
  </body>
</html>
